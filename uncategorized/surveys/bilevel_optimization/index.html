
<!DOCTYPE html>
<html>
<head>
    <title> Here is Shaoyu </title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--网页标题左侧显示-->
    <link rel="icon" href="/fish.ico" type="image/x-icon">
    <!--收藏夹显示图标-->
    <link rel="shortcut icon" href="/fish.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">
    <link href="https://cdn.staticfile.org/twitter-bootstrap/5.1.1/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css">
    <script src="https://cdn.staticfile.org/twitter-bootstrap/5.1.1/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    
<link rel="stylesheet" href="../../../css/prism.css">
 
    
<script src="../../../js/prism.js"></script>

    
    
<link rel="stylesheet" href="../../../css/index.css">
 
    
<script src="../../../js/search.js"></script>



     
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            }
        };
        </script>
     

     
        <script src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js"> </script>
        
<script src="../../../js/fancybox.js"></script>

    

    <script type="text/javascript">
        var search_path = "search.xml";
        if (search_path.length == 0) {
            search_path = "search.xml";
        }
        var path = "/" + search_path;
        searchFunc(path, 'local-search-input', 'local-search-result');
    </script>
<meta name="generator" content="Hexo 5.4.2"></head>
 
 
<body>
    <!-- 导航栏 -->
    <!-- 导航栏 -->
<nav class="navbar navbar-expand-md navbar-dark bg-dark mb-4 pt-2 pb-2">
    <div class="container">
        <!-- 标题 --> 
        <a class="navbar-brand navbar-expand-sm" href="/">
            <img class="nofancybox" src="/shark.svg" style="width: 65px;">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
                aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- 左边右边导航按钮 --> 
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav me-auto">
                <!-- 左右两侧的导航栏 -->

 
 

    <li class="nav-item">
        <a class="nav-link" href="../../../">
           <big> <i class="fa fa-home ps-1" ></i> Home</big>
        </a>
    </li>

    <li class="nav-item">
        <a class="nav-link" href="../../../note">
           <big> <i class="fa fa-file-text-o ps-1" ></i> Notes</big>
        </a>
    </li>

    <li class="nav-item">
        <a class="nav-link" href="../../../survey">
           <big> <i class="fa fa-globe ps-1" ></i> Surveys</big>
        </a>
    </li>

    <li class="nav-item">
        <a class="nav-link" href="../../../paperlist">
           <big> <i class="fa fa-cc-discover ps-1" ></i> Paper Lists</big>
        </a>
    </li>

    <li class="nav-item">
        <a class="nav-link" href="../../../archives">
           <big> <i class="fa fa-archive ps-1" ></i> Archives</big>
        </a>
    </li>

    <li class="nav-item">
        <a class="nav-link" href="../../../about">
           <big> <i class="fa fa-user ps-1" ></i> About</big>
        </a>
    </li>
 
 
            </ul>

            
            <form class="">
                <div class="d-flex">
                    <button class="btn text-muted fa fa-search d-none d-md-block d-lg-block" disabled></button>
                    <input id="local-search-input" class="form-control me-2 pe-4" type="search"
                            placeholder="搜索 " aria-label="Search">
                </div>
                <div id="local-search-result" style="position:absolute; padding-top: 8px; max-height: 960px; width: 480px;overflow-y: scroll; z-index: 1050;"></div>
            </form>
            
            <ul class="navbar-nav">
                <!-- 左右两侧的导航栏 -->

 
 
            </ul>
        </div>
    </div>
</nav>


    <main class="container">
        
<div class="container-fluid markdown-section">
<div class="row">
    <div class="col-md-2 d-none d-sm-none d-md-block">
        <div class="">
            <!-- 同一类型的文件 -->
<!-- 尽可能做到每篇文章只有一个类
    1. 获得 post 的类别 categories
     2.1 如果 categories.length === 0，啥也不做
     2.2 如果 categories === 1，渲染这个类的所有文章
     2.3 如果 categories.length > 1 ，则以第一个类为准渲染所有文章
-->


 
        </div>
    </div>
    <div class="col-md-8 col-sm-12">
        <!-- 博客详情 -->
        <div class="">
            <!-- ps-4 pe-4 pt-2 -->
            <p class="h2">
                <span class="post-title">
                    Paradigm of Bi-level Optimization
                </span>   
            </p>

            <div class="pb-3 pt-1 pe-3">
                <i class="fa fa-calendar p-1"></i>
                2023/02/16 16:10:00 

                <i class="fa fa-pencil"> </i>
                2023/02/16 21:50:00 

                <!--
                <i class="fa fa-folder-open p-1"> </i> 
                <span class="tag-hover">
                     
                </span>
                -->

                <i class="fa fa-tags p-1"> </i>
                <span class="tag-hover">
                    
                        <a href="../../../tags/survey/" class="link-dark text-decoration-none"> 
                            survey 
                        </a>
                    
                        <a href="../../../tags/optimization/" class="link-dark text-decoration-none"> 
                            optimization 
                        </a>
                    
                </span>
            </div>

            <div class="border-bottom pb-2">
                <p>本文调研了双层优化问题的解决范式，对两种popular的<strong>基于梯度</strong>的方法——AID、ITD作出介绍与总结。最后，本文对如何利用bilevel optimization解决sim2real问题难点作出梳理。</p>
<p>本调研的motivation来自于<a target="_blank" rel="noopener" href="//uncategorized/surveys/sim2real/">sim2real</a>问题——借助少量的仿真数据，如何找到一组仿真器参数$\phi$，在该组参数下的仿真数据上训练一个异常检测模型，将会在现实数据中有较好的效果——这可以类比于一个超参数调优问题。</p>
<span id="more"></span>

<h2 id="1-Formulation-of-Bilevel-Optimization"><a href="#1-Formulation-of-Bilevel-Optimization" class="headerlink" title="1. Formulation of Bilevel Optimization"></a>1. Formulation of Bilevel Optimization</h2><p>双层优化问题的形式一般定义为</p>
<p>$$
\begin{array}{rl}
\min & \Phi(\boldsymbol{x}):=f(\boldsymbol{x}, \boldsymbol{y}^{\star}) \\
\text { s.t. } & \boldsymbol{y}^{\star}=\underset{\boldsymbol{y}}{\arg \min }  g\left(\boldsymbol{x}, \boldsymbol{y}\right) \\
\text { var. } & \boldsymbol{x}, \boldsymbol{y},
\end{array}
$$</p>
在双层优化中，一个优化问题嵌入或嵌套在另一个问题中。外部优化问题被称为上层优化问题，而内部优化问题被称作下层优化问题，$\boldsymbol{x}, \boldsymbol{y}$ 分别为上下层的优化变量。

<p>双层优化问题的解决范式包括以下两类：</p>
<ol>
<li><p>Double Loop / gradient-based：内外层问题分别根据其问题特性（可微、平滑、凸等），采用不同的优化方法，两个问题的解通过<strong>超梯度</strong>串联起来，以寻找一个全局的（渐进）最优解。这类方法可以概括为“启发式”——有方向的迭代，一般来说给一个初始可行解然后按照实际问题确定一个下降方向，不断搜索直到gap满足精度要求，但这里必须注意，启发式算法很有可能得到的不是最优解，一定要对结果进行论证。</p>
<ul>
<li>此类范式的方法包括：approximate implicit differentiation (AID)、iterative differentiation (ITD)，这两类方法均为基于梯度的方法。</li>
</ul>
</li>
<li><p>Single Loop / constrain-based：在这种方法中，下层优化问题可以视为是上层优化问题的约束，因此双层优化也可以视为<strong>约束优化</strong>的特殊情况。这类方法可以概括为“解析式”——接算出解析节，这种方法的逻辑大都使用KKT，对偶，罚函数等将双层规划转化成单层，然后利用单层的方法求解。</p>
<ul>
<li>解决带约束优化的方法包括但不限于：Karush–Kuhn–Tucker（KKT，KKT条件表现为拉格朗日和互补约束，并将整体双层优化问题简化为单级约束优化问题），Penalty Function Methods等[1]。</li>
</ul>
</li>
</ol>
<blockquote>
<p>[1] Sinha, A., Malo, P., &amp; Deb, K. (2017). A review on bilevel optimization: From classical to evolutionary approaches and applications. <em>IEEE Transactions on Evolutionary Computation</em>, <em>22</em>(2), 276-295.</p>
<p>[2] <a target="_blank" rel="noopener" href="https://www.zhihu.com/question/25059001?sort=created">https://www.zhihu.com/question/25059001?sort=created</a></p>
</blockquote>
<h2 id="2-Gradient-based-iterative-methods"><a href="#2-Gradient-based-iterative-methods" class="headerlink" title="2. Gradient-based iterative methods"></a>2. Gradient-based iterative methods</h2><p>Single Loop / constrain-based 方法往往涉及大量约束因此难以在机器学习任务中应用。在下文中，将对两种 Double Loop / gradient-based 的方法——AID / ITD作出总结。主要的formulation参考下文：</p>
<blockquote>
<p>Ji, K., Yang, J., &amp; Liang, Y. (2021, July). Bilevel optimization: Convergence analysis and enhanced design. In <em>International conference on machine learning</em> (pp. 4882-4892). PMLR.</p>
</blockquote>
<p>这两种算法均涉及到一个概念：<strong>hyper-gradient（超梯度）</strong> <a target="_blank" rel="noopener" href="https://github.com/gbaydin/hypergradient-descent">link</a></p>
<ul>
<li>梯度（gradient）：在一个基于梯度的优化问题中，优化目标对<strong>模型参数</strong>的梯度，被称为 basic gridient，简称为梯度</li>
<li>超梯度（hyper-gridient）：在上述的优化问题中，将优化目标对<strong>优化过程的超参数</strong>（如 learning rate, momentum, regularization parameters, etc.）求梯度，则称为超梯度。</li>
</ul>
<p>在双层优化中，待优化的参数往往是内层优化问题的变量（如模型参数），而外层优化问题的变量一般为算法超参数（如模型超参），因此这里<strong>称：外层优化目标对外层变量的梯度——超梯度</strong>。</p>
<p>🌟 AID 和 ITD 的不同之处在于，他们计算超梯度的方法不同，因此使用了不同的近似方法</p>
<h3 id="2-1-Approximate-Implicit-Differentiation-AID"><a href="#2-1-Approximate-Implicit-Differentiation-AID" class="headerlink" title="2.1 Approximate Implicit Differentiation (AID)"></a>2.1 Approximate Implicit Differentiation (AID)</h3><p>AID方法的核心是：用一个近似值来代替隐微分（implicit differentitation），以构造超梯度。AID的超梯度计算公式为：</p>
<p>$$
\nabla \Phi\left(x_k\right)=\nabla_x f\left(x_k, y^{*}\left(x_k\right)\right)-\nabla_x \nabla_y g\left(x_k, y^{*}\left(x_k\right)\right) v_k^{*}
$$</p>
其中 $v_k^{*}$ 是下面的线性系统 $\nabla_y^2 g\left(x_k, y^{*}\left(x_k\right)\right) v=\nabla_y f\left(x_k, y^{*}\left(x_k\right)\right)$ 的解。以上是超梯度的原始计算公式。

<p><strong>AID的求解思路如下：</strong></p>
<ol>
<li>利用 $N-step$ 的 conjugate-gradient (CG) 方法来求解线性系统的解 $v_k^N$。</li>
<li>将上述解 $v_k^N$ 和内层的最近一次的迭代解 $y_k^T$ 带入上述的超梯度公式，得到超梯度的近似值，即：</li>
</ol>
<p>$$
\nabla \Phi\left(x_k\right)=\nabla_x f\left(x_k, y_k^T\right)-\nabla_x \nabla_y g\left(x_k, y_k^T\right) v_k^N
$$</p>

<p>⚠️ Note：注意——上式中的最后一项 Jacobian-vector product 可以通过自动微分求出，因此上式可以被计算。</p>
<h3 id="2-2-Iterative-Differentiation-ITD"><a href="#2-2-Iterative-Differentiation-ITD" class="headerlink" title="2.2 Iterative Differentiation (ITD)"></a>2.2 Iterative Differentiation (ITD)</h3><p>ITD方法的核心是：超梯度的近似值具有一个解析形式，该解析形式可以通过迭代的方式求出。ITD的超梯度计算公式为：</p>
<p>$$
\nabla \Phi\left(x_k\right)=\frac{\partial f\left(x_k, y^{*}\left(x_k\right)\right)}{\partial x_k}
$$</p>
其近似估计为$\frac{\partial f\left(x_k, y_k^D\left(x_k\right)\right)}{\partial x_k}$，而该梯度存在下述的解析形式，因此可以被计算：
<p>$$
\begin{aligned}
\frac{\partial f\left(x_{k}, y_{k}^{D}\right)}{\partial x_{k}}= & \nabla_{x} f\left(x_{k}, y_{k}^{D}\right)-\alpha \sum_{t=0}^{D-1} \nabla_{x} \nabla_{y} g\left(x_{k}, y_{k}^{t}\right) \\
& \times \prod_{j=t+1}^{D-1}\left(I-\alpha \nabla_{y}^{2} g\left(x_{k}, y_{k}^{j}\right)\right) \nabla_{y} f\left(x_{k}, y_{k}^{D}\right)
\end{aligned}
$$</p>

<h3 id="2-3-Bilevel-algorithms-via-AID-or-ITD"><a href="#2-3-Bilevel-algorithms-via-AID-or-ITD" class="headerlink" title="2.3 Bilevel algorithms via AID or ITD"></a>2.3 Bilevel algorithms via AID or ITD</h3><img src="https://raw.githubusercontent.com/KMdsy/figurebed/master/img/image-20230216213116561.png" alt="image-20230216213116561" style="zoom:50%;" />

<h2 id="3-利用双层优化解sim2real问题的难点"><a href="#3-利用双层优化解sim2real问题的难点" class="headerlink" title="3. 利用双层优化解sim2real问题的难点"></a>3. 利用双层优化解sim2real问题的难点</h2><p>简要梳理：AID ITD分别是两种借助超梯度进行内外层优化串联的方法，但在实际计算的过程中，仍存在 <strong>“外层优化问题不可微，因此无法求外层优化问题梯度”</strong> 的问题，即 $\nabla_{x} f(x, y)$ 。因此，利用双层优化问题解sim2real问题的难点在于——如何解决外层的不可微问题。这也是下一篇survey的调研重点。</p>
 
            </div>
        </div>
        
        <div class="mt-3">
            <!-- 前一页后一页 -->
<div class="previous-next-links">
     

     
    <div class="next-design-link">
        <a href="../../notes/NS3/">
            NS3无线网络仿真器
            <i style="font-size:16px;" class="fa fa-arrow-right" aria-hidden="true"></i>
        </a>
    </div>
 
</div> 
             
        </div>

    </div>
    <div class="col-2">
        <div class="d-none d-sm-none d-md-block sticky-top border-start">
             
    
        <div>
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Formulation-of-Bilevel-Optimization"><span class="toc-number">1.</span> <span class="toc-text">1. Formulation of Bilevel Optimization</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Gradient-based-iterative-methods"><span class="toc-number">2.</span> <span class="toc-text">2. Gradient-based iterative methods</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-Approximate-Implicit-Differentiation-AID"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 Approximate Implicit Differentiation (AID)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-Iterative-Differentiation-ITD"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 Iterative Differentiation (ITD)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-Bilevel-algorithms-via-AID-or-ITD"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 Bilevel algorithms via AID or ITD</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%88%A9%E7%94%A8%E5%8F%8C%E5%B1%82%E4%BC%98%E5%8C%96%E8%A7%A3sim2real%E9%97%AE%E9%A2%98%E7%9A%84%E9%9A%BE%E7%82%B9"><span class="toc-number">3.</span> <span class="toc-text">3. 利用双层优化解sim2real问题的难点</span></a></li></ol> 
        </div>
    
 

        </div>
    </div>
</div>
</div>
 
    </main>

    <!-- 底部栏 -->
    <footer class="bg-dark pt-1 pb-0 mt-5">
    <div class="container pb-3 pt-3 text-center">
        <p class="text-muted tag-hover">
            Powered by 
             <a class="link-secondary text-decoration-none" target="_blank" rel="noopener" href="https://hexo.io">
                 Hexo.io
            </a> &  <a class="link-secondary text-decoration-none" target="_blank" rel="noopener" href="https://github.com/smile-yan/hexo-theme-heyan">
               heyan
            </a>
            <br>
        </p>
    </div>
</footer>
</body> 
</html>